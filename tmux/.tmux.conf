# --------------------------------
# Set Default shell to zsh
# --------------------------------
set-option -g default-shell /usr/bin/zsh
set-option -g default-command /usr/bin/zsh

# ------------------------------
# General
# ------------------------------

unbind C-b
set-option -g prefix C-a
set -g base-index 1 
set -g escape-time 0 
set -g detach-on-destroy off 
setw -g mode-keys vi # Use vi style keys in copy mode
set -g mouse off
set -g renumber-windows on
set -g history-limit 10000
set -s default-terminal 'xterm-256color'
set -g set-clipboard on # Use system clipboard when possible
setw -g automatic-rename on
set -g repeat-time 1000  # increase "prefix-free" window

# OSC52 copy to local clipboard (works over SSH)
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel \
"tmux save-buffer - | base64 | tr -d '\n' | sed 's/.*/\x1b]52;c;&\x07/'"

# Prefix + / to search
bind-key / copy-mode \; send-key ?

# Reload config 
bind r source-file ~/.tmux.conf \; display "tmux reloaded"

##### Safe Ctrl-D (don‚Äôt kill last tmux session) #####
bind -n C-d if-shell -F "#{&&:#{==:#{session_windows},1},#{==:#{window_panes},1}}" \
  "detach-client" \
  "send-keys C-d"

# ------------------------------
# Splits (vim-style)
# ------------------------------

unbind '"'
unbind %
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

# ------------------------------
# Pane navigation (vim keys)
# ------------------------------
# Neovim <-> tmux navigation
# ------------------------------
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(n?vim)$'"

bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"

# Resize panes
bind < resize-pane -L 10
bind + resize-pane -D 10
bind - resize-pane -U 10
bind > resize-pane -R 10

# ------------------------------
# Windows
# ------------------------------
bind A choose-session
bind m choose-tree
bind c new-window -c "#{pane_current_path}"
bind n next-window
bind p previous-window

# Swap Windows
bind-key -n C-S-Left swap-window -d -t -1
bind-key -n C-S-Right swap-window -d -t +1

# Session Management
 unbind S
 bind S command-prompt 'rename-session %%'
 bind N new-session
# # Create new session from current window
 bind B command-prompt -p "New session name:" "new-session -d -s '%%'; move-window -t '%%:'; switch-client -t '%%'"

# -----------------------------
# Popups
# -----------------------------

bind C-g display-popup \
  -d "#{pane_current_path}" \
  -w 80% \
  -h 80% \
  -E "lazygit"
bind C-f display-popup \
  -d "#{pane_current_path}" \
  -w 90% \
  -h 90% \
  -E "yazi"
bind C-t display-popup \
  -d "#{pane_current_path}" \
  -w 75% \
  -h 75% \
  -E "zsh"
bind C-c display-popup -E 'bash -i -c "read -p \"Session name: \" name; tmux new-session -d -s \$name && tmux switch-client -t \$name"'
bind C-n display-popup -E "tmux list-sessions | sed -E 's/:.*$//' | grep -v \"^$(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"

# ------------------------------
# Status bar
# ------------------------------
set -g @bg "#282A36" 

set-option -g status "on"

set -g status-position bottom
set -g status-interval 5

# Length of tmux status line
set -g status-left-length 30
set -g status-right-length 30

# Default statusbar color
set-option -g status-style "bg=default,fg=white" 

# Default window title colors
set-window-option -g window-status-style "bg=green,fg=#{@bg}"

# Default window with an activity alert
set-window-option -g window-status-activity-style "bg=#{@bg},fg=yellow"

# Active window title colors
set-window-option -g window-status-current-style "bg=red,fg=#{@bg}"

# Set pan border lines style
set -g pane-border-lines heavy

# Set active pane border color
set-option -g pane-active-border-style "fg=#50FA7B"

# Set inactive pane border color
set-option -g pane-border-style "fg=#44475A"

# Message info
set-option -g message-style "bg=colour242,fg=white"

# Writing commands inactive
set-option -g message-command-style "bg=white,fg=colour237" 

# Pane number display
set-option -gF display-panes-active-colour "white"
set-option -gF display-panes-colour "#{@bg}"

# Clock
set-window-option -gF clock-mode-colour "cyan"

# Bell
set-window-option -g window-status-bell-style "bg=red,fg=#{@bg}"

set-option -g status-left "\
#[fg=#{@bg}, bg=#BD93F9, bold]#{?client_prefix,#[bg=#FFB86C]#[fg=#{@bg}],} #S \
#[fg=#BD93F9, bg=default]#{?client_prefix,#[fg=#FFB86C],}ÓÇ∞#{?window_zoomed_flag, üîç,}"

set-option -g status-right "\
#[fg=cyan] ÓÇ≤\
#[fg=#{@bg}, bg=cyan] #H "

set-window-option -g window-status-current-format "\
#[fg=#{@bg}, bg=green]ÓÇ∞\
#[fg=#{@bg}, bg=green] #I* ÓÇ±\
#[fg=#{@bg}, bg=green, bold] #W \
#[fg=green, bg=#{@bg}]ÓÇ∞"

set-window-option -g window-status-format "\
#[fg=#{@bg},bg=colour242,noitalics]ÓÇ∞\
#[fg=#{@bg},bg=colour242] #I ÓÇ±\
#[fg=#{@bg}, bg=colour242] #W \
#[fg=colour242, bg=#{@bg}]ÓÇ∞"

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'christoomey/vim-tmux-navigator'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
